<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Interactivo de Proyectos en Costa Rica</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Cargar fuente Montserrat desde Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; }
        #map {
            height: 80vh; /* Altura mayor para formato vertical */
            width: 95%; /* Ancho ajustado para centrado */
            margin: 0 auto; /* Centrado horizontal */
            min-height: 300px;
        }
        #controls { 
            position: absolute; 
            top: 10px; 
            left: 50px; /* Mover levemente a la derecha para evitar salida del encuadre */
            z-index: 1000; 
            background: white; 
            padding: 5px; 
            border-radius: 5px; 
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        select { 
            padding: 3px; 
            font-size: 14px; 
            width: 150px; 
            margin-bottom: 3px; 
            display: block;
        }
        /* Media query para móviles */
        @media (max-width: 768px) {
            #map {
                height: 90vh; /* Mayor altura para formato vertical en móviles */
                width: 90%; /* Ancho reducido para mejor ajuste */
                min-height: 250px;
            }
            #controls {
                top: 5px;
                left: 20px; /* Ajustado a la derecha en móviles para evitar bordes */
                padding: 3px;
            }
            select {
                width: 120px;
                font-size: 12px;
            }
        }
        .leaflet-popup-content {
            font-family: 'Montserrat', sans-serif;
            font-size: 16px;
            line-height: 1.4;
        }
        .leaflet-popup-content b {
            font-weight: 700; /* Negrita con Montserrat */
        }
        .leaflet-popup-content .project-name {
            margin-bottom: 10px; /* Separación leve después del name */
        }
        .leaflet-popup-content ul {
            margin-top: 5px; /* Separación leve entre name y la lista */
            padding-left: 20px; /* Ajuste para viñetas */
            list-style-type: disc; /* Viñetas estándar */
        }
        .leaflet-popup-content ul li {
            margin-bottom: 5px; /* Separación leve entre ítems de la lista */
        }
    </style>
</head>
<body>
    <div id="controls">
        <select id="categoryFilter" onchange="updateProductFilter()">
            <option value="all">Todas las categorías</option>
        </select>
        <select id="productFilter" onchange="filterMarkers()">
            <option value="all">Todos los productos</option>
        </select>
    </div>
    <div id="map"></div>
    <script>
        // Esperar a que el DOM esté listo antes de inicializar
        document.addEventListener('DOMContentLoaded', function() {
            var map = L.map('map', {
                zoomControl: false // Desactivar control de zoom por defecto
            }).setView([9.9281, -84.0907], 8);

            // Usar capa satelital de Esri
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
            }).addTo(map);

            // Mover el control de zoom a la esquina inferior derecha
            L.control.zoom({
                position: 'bottomright'
            }).addTo(map);

            // Definir íconos personalizados con colores sutiles por categoría
            var icons = {
                'Agrícola': L.icon({
                    iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [0, -41],
                    shadowSize: [41, 41]
                }),
                'Ganadería': L.icon({
                    iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-brown.png',
                    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [0, -41],
                    shadowSize: [41, 41]
                }),
                'Acuícola': L.icon({
                    iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [0, -41],
                    shadowSize: [41, 41]
                }),
                'Procesado': L.icon({
                    iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
                    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [0, -41],
                    shadowSize: [41, 41]
                })
            };

            var projects = [
                {
                    category: "Agrícola",
                    name: "Productos D´Fresa",
                    product: "Fresa",
                    characteristics: "Fresa fresca y congelada",
                    availability: "Todo el año",
                    phone: "8707-9642",
                    email: "No incluido",
                    deliveries: "A cantones vecinos",
                    others: "No incluido",
                    lat: 10.17461859,
                    lng: -84.15852415
                },
                {
                    category: "Agrícola",
                    name: "ASODUCKUA",
                    product: "Plátano",
                    characteristics: "No incluido",
                    availability: "Todo el año",
                    phone: "8773-9008",
                    email: "No incluido",
                    deliveries: "Dentro del cantón",
                    others: "Asociación de personas indígenas",
                    lat: 9.626096579,
                    lng: -82.87477416
                },
                {
                    category: "Agrícola",
                    name: "ASODUCKUA",
                    product:
