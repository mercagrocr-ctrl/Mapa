<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Interactivo de Proyectos en Costa Rica</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; font-family: 'Montserrat', sans-serif; }
        #map {
            height: 80vh;
            width: 100%;
            margin: 0;
            min-height: 300px;
            position: relative;
            transition: height 0.3s ease;
        }
        #controls { 
            position: absolute; 
            top: 20px; 
            left: 50px;
            z-index: 1000; 
            background: white; 
            padding: 5px; 
            border-radius: 5px; 
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        #map #fullscreen-btn {
            position: absolute;
            bottom: 50px;
            left: 20px;
            padding: 8px 12px;
            font-size: 14px;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
            background: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 3px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: all 0.2s;
        }
        #map #fullscreen-btn:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }
        select { 
            padding: 5px; 
            font-size: 14px; 
            width: 150px; 
            margin-bottom: 5px; 
            display: block;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        /* Media query para móviles */
        @media (max-width: 768px) {
            #map {
                height: 90vh;
                min-height: 250px;
            }
            #controls {
                top: 10px;
                left: 15px;
                padding: 4px;
                font-size: 12px;
            }
            select {
                width: 130px;
                font-size: 12px;
                padding: 4px;
            }
            .leaflet-popup-content {
                font-size: 10px !important;
                max-width: 140px !important;
                line-height: 1.2 !important;
                padding: 5px !important;
            }
            .leaflet-popup-content ul {
                padding-left: 12px !important;
                margin: 4px 0 !important;
            }
            #map #fullscreen-btn {
                font-size: 12px;
                padding: 6px 10px;
                bottom: 45px;
                left: 15px;
            }
        }

        .leaflet-popup-content {
            font-family: 'Montserrat', sans-serif;
            font-size: 16px;
            line-height: 1.4;
        }
        .leaflet-popup-content b {
            font-weight: 700;
        }
        .leaflet-popup-content .project-name {
            margin-bottom: 8px;
            font-size: 17px;
        }
        .leaflet-popup-content ul {
            margin: 6px 0;
            padding-left: 20px;
            list-style-type: disc;
        }
        .leaflet-popup-content ul li {
            margin-bottom: 4px;
        }

        /* Pantalla completa */
        #map:fullscreen,
        #map:-webkit-full-screen,
        #map:-moz-full-screen,
        #map:-ms-fullscreen {
            height: 100vh !important;
            width: 100% !important;
        }
    </style>
</head>
<body>
    <div id="controls">
        <select id="categoryFilter" onchange="updateProductFilter()">
            <option value="all">Todas las categorías</option>
        </select>
        <select id="productFilter" onchange="filterMarkers()">
            <option value="all">Todos los productos</option>
        </select>
    </div>
    <div id="map">
        <button id="fullscreen-btn">Pantalla completa</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var map = L.map('map', {
                zoomControl: false
            }).setView([9.9281, -84.0907], 8);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            L.control.zoom({
                position: 'bottomright'
            }).addTo(map);

            var icons = {
                'Agrícola': L.icon({
                    iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [0, -41],
                    shadowSize: [41, 41]
                }),
                'Ganadería': L.icon({
                    iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-brown.png',
                    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [0, -41],
                    shadowSize: [41, 41]
                }),
                'Acuícola': L.icon({
                    iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [0, -41],
                    shadowSize: [41, 41]
                }),
                'Procesado': L.icon({
                    iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
                    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [0, -41],
                    shadowSize: [41, 41]
                })
            };

            var projects = [
                { category: "Agrícola", name: "Productos D´Fresa", product: "Fresa", characteristics: "Fresa fresca y congelada", otherp: "No", availability: "Todo el año", phone: "8707-9642", email: "No incluido", deliveries: "A cantones vecinos", others: "No incluido", lat: 10.17461859, lng: -84.15852415 },
                { category: "Agrícola", name: "ASODUCKUA", product: "Plátano", characteristics: "No incluido", otherp: "Tilapia y cacao", availability: "Todo el año", phone: "8773-9008", email: "No incluido", deliveries: "Dentro del cantón", others: "Asociación de personas indígenas", lat: 9.626096579, lng: -82.87477416 },
                { category: "Agrícola", name: "ASODUCKUA", product: "Cacao", characteristics: "No incluido", otherp: "Plátano y tilapia", availability: "Todo el año", phone: "8773-9008", email: "No incluido", deliveries: "Dentro del cantón", others: "Asociación de personas indígenas", lat: 9.626096579, lng: -82.87477416 },
                { category: "Acuícola", name: "ASODUCKUA", product: "Pescado", characteristics: "Tilapia", otherp: "Plátano y cacao", availability: "Todo el año", phone: "8773-9008", email: "No incluido", deliveries: "Dentro del cantón", others: "Asociación de personas indígenas", lat: 9.626096579, lng: -82.87477416 },
                { category: "Procesado", name: "Entre Aromas", product: "Varios", characteristics: "Yogurt, condimentos naturales, mermeladas, fruta deshidratada, entre otros", availability: "Todo el año", phone: "8317-5759", email: "No incluido", deliveries: "A cantones vecinos", others: "Proyecto con Bandera Azul Ecológica", lat: 10.53625097, lng: -85.25530138 },
                { category: "Agrícola", name: "Finca agrícola", product: "Papa", characteristics: "No aportados", otherp: "Cebolla y zanahoria", availability: "Todo el año", phone: "8881-7544", email: "No incluido", deliveries: "Dentro del cantón", others: "No incluido", lat: 9.916927899, lng: -83.89214605 },
                { category: "Agrícola", name: "Finca agrícola", product: "Cebolla", characteristics: "No aportados", otherp: "Papa y zanahoria", availability: "Todo el año", phone: "8881-7544", email: "No incluido", deliveries: "Dentro del cantón", others: "No incluido", lat: 9.916927899, lng: -83.89214605 },
                { category: "Agrícola", name: "Finca agrícola", product: "Zanahoria", characteristics: "No aportados", otherp: "Cebolla y papa", availability: "Todo el año", phone: "8881-7544", email: "No incluido", deliveries: "Dentro del cantón", others: "No incluido", lat: 9.916927899, lng: -83.89214605 },
                { category: "Agrícola", name: "Agricarrots Produce and Trading Company S.A.", product: "Papa", characteristics: "Producto lavado. Diversas calidades", otherp: "Zanahoria", availability: "Todo el año", phone: "7122-7486", email: "juanjoramirez1994@gmail.com", deliveries: "Donde se requiera", others: "Proyecto con Buenas Prácticas Agrícolas y de Manufactura", lat: 9.887036196, lng: -83.87008008 },
                { category: "Agrícola", name: "Agricarrots Produce and Trading Company S.A.", product: "Zanahoria", characteristics: "Producto lavado. Diversas calidades hasta mínimamente procesado para industria", otherp: "Papa", availability: "Todo el año", phone: "7122-7486", email: "juanjoramirez1994@gmail.com", deliveries: "Donde se requiera", others: "Proyecto con Buenas Prácticas Agrícolas y de Manufactura", lat: 9.887036196, lng: -83.87008008 },
                { category: "Agrícola", name: "Finca San Gabriel", product: "Tomate bola", characteristics: "No incluido", otherp: "Tomate cherry, pepino, lechuga, culantro castilla, zucchini, jocote y manzana de agua", availability: "Todo el año", phone: "8853-2842", email: "No incluido", deliveries: "En cantones cercanos", others: "Certificado Tico-BPA y Certificado en Agricultura Agroecológica", lat: 9.788408328654098, lng: -84.10966829010474 },
                { category: "Agrícola", name: "Finca San Gabriel", product: "Tomate cherry", characteristics: "No incluido", otherp: "Tomate bola, pepino, lechuga, culantro castilla, zucchini, jocote y manzana de agua", availability: "Todo el año", phone: "8853-2842", email: "No incluido", deliveries: "En cantones cercanos", others: "Certificado Tico-BPA y Certificado en Agricultura Agroecológica", lat: 9.788408328654098, lng: -84.10966829010474 },
                { category: "Agrícola", name: "Finca San Gabriel", product: "Pepino", characteristics: "No incluido", otherp: "Tomate bola, tomate cherry, lechuga, culantro castilla, zucchini, jocote y manzana de agua", availability: "Todo el año", phone: "8853-2842", email: "No incluido", deliveries: "En cantones cercanos", others: "Certificado Tico-BPA y Certificado en Agricultura Agroecológica", lat: 9.788408328654098, lng: -84.10966829010474 },
                { category: "Agrícola", name: "Finca San Gabriel", product: "Culantro castilla", characteristics: "No incluido", otherp: "Tomate bola, tomate cherry, lechuga, pepino, zucchini, jocote y manzana de agua", availability: "Todo el año", phone: "8853-2842", email: "No incluido", deliveries: "En cantones cercanos", others: "Certificado Tico-BPA y Certificado en Agricultura Agroecológica", lat: 9.788408328654098, lng: -84.10966829010474 },
                { category: "Agrícola", name: "Finca San Gabriel", product: "Lechuga", characteristics: "No incluido", otherp: "Tomate bola, tomate cherry, culantro castilla, pepino, zucchini, jocote y manzana de agua", availability: "Todo el año", phone: "8853-2842", email: "No incluido", deliveries: "En cantones cercanos", others: "Certificado Tico-BPA y Certificado en Agricultura Agroecológica", lat: 9.788408328654098, lng: -84.10966829010474 },
                { category: "Agrícola", name: "Finca San Gabriel", product: "Zucchini", characteristics: "No incluido", otherp: "Tomate bola, tomate cherry, culantro castilla, pepino, lechuga, jocote y manzana de agua", availability: "Todo el año", phone: "8853-2842", email: "No incluido", deliveries: "En cantones cercanos", others: "Certificado Tico-BPA y Certificado en Agricultura Agroecológica", lat: 9.788408328654098, lng: -84.10966829010474 },
                { category: "Agrícola", name: "Finca San Gabriel", product: "Jocote", characteristics: "No incluido", otherp: "Tomate bola, tomate cherry, culantro castilla, pepino, lechuga, zucchini y manzana de agua", availability: "Por temporada", phone: "8853-2842", email: "No incluido", deliveries: "En cantones cercanos", others: "Certificado Tico-BPA y Certificado en Agricultura Agroecológica", lat: 9.788408328654098, lng: -84.10966829010474 },
                { category: "Agrícola", name: "Finca San Gabriel", product: "Manzana de agua", characteristics: "No incluido", otherp: "Tomate bola, tomate cherry, culantro castilla, pepino, lechuga, zucchini y jocote", availability: "Por temporada", phone: "8853-2842", email: "No incluido", deliveries: "En cantones cercanos", others: "Certificado Tico-BPA y Certificado en Agricultura Agroecológica", lat: 9.788408328654098, lng: -84.10966829010474 }
            ];

            var uniqueCategories = [...new Set(projects.map(p => p.category))].sort();
            var categorySelect = document.getElementById('categoryFilter');
            uniqueCategories.forEach(cat => {
                var opt = document.createElement('option');
                opt.value = cat; opt.text = cat;
                categorySelect.appendChild(opt);
            });

            var productSelect = document.getElementById('productFilter');
            var markersLayer = L.layerGroup().addTo(map);

            window.updateProductFilter = function() {
                var selCat = categorySelect.value;
                productSelect.innerHTML = '<option value="all">Todos los productos</option>';
                var prods = [...new Set(projects
                    .filter(p => selCat === 'all' || p.category === selCat)
                    .map(p => p.product))].sort();
                prods.forEach(prod => {
                    var opt = document.createElement('option');
                    opt.value = prod; opt.text = prod;
                    productSelect.appendChild(opt);
                });
                filterMarkers();
            };

            window.filterMarkers = function() {
                var selCat = categorySelect.value;
                var selProd = productSelect.value;
                markersLayer.clearLayers();
                projects.forEach(p => {
                    if ((selCat === 'all' || p.category === selCat) && (selProd === 'all' || p.product === selProd)) {
                        var icon = icons[p.category] || L.icon({
                            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
                            shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
                            iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [0, -41], shadowSize: [41, 41]
                        });
                        var marker = L.marker([p.lat, p.lng], { icon: icon }).addTo(markersLayer);
                        marker.bindPopup(
                            '<div class="project-name"><b>' + p.name + '</b></div>' +
                            '<ul>' +
                                '<li><b>Producto:</b> ' + p.product + '</li>' +
                                '<li><b>Características:</b> ' + p.characteristics + '</li>' +
                                '<li><b>Otros productos:</b> ' + p.otherp + '</li>' +
                                '<li><b>Disponibilidad:</b> ' + p.availability + '</li>' +
                                '<li><b>Teléfono:</b> ' + p.phone + '</li>' +
                                '<li><b>Correo:</b> ' + p.email + '</li>' +
                                '<li><b>Entregas:</b> ' + p.deliveries + '</li>' +
                                '<li><b>Otros detalles:</b> ' + p.others + '</li>' +
                            '</ul>'
                        );
                    }
                });
                setTimeout(() => map.invalidateSize(), 100);
            };

            updateProductFilter();
            setTimeout(() => map.invalidateSize(), 200);

            // === PANTALLA COMPLETA ===
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const mapContainer = document.getElementById('map');

            function enterFullscreen() {
                if (mapContainer.requestFullscreen) {
                    mapContainer.requestFullscreen();
                } else if (mapContainer.webkitRequestFullscreen) {
                    mapContainer.webkitRequestFullscreen();
                } else if (mapContainer.msRequestFullscreen) {
                    mapContainer.msRequestFullscreen();
                } else if (mapContainer.mozRequestFullScreen) {
                    mapContainer.mozRequestFullScreen();
                }
            }

            function exitFullscreen() {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                }
            }

            function handleFullscreenChange() {
                const isFullscreen = document.fullscreenElement ||
                    document.webkitFullscreenElement ||
                    document.mozFullScreenElement ||
                    document.msFullscreenElement;

                if (isFullscreen) {
                    fullscreenBtn.textContent = 'Salir pantalla completa';
                    mapContainer.style.height = '100vh';
                } else {
                    fullscreenBtn.textContent = 'Pantalla completa';
                    mapContainer.style.height = window.innerWidth <= 768 ? '90vh' : '80vh';
                }
                setTimeout(() => map.invalidateSize(true), 300);
            }

            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
            document.addEventListener('MSFullscreenChange', handleFullscreenChange);

            fullscreenBtn.addEventListener('click', () => {
                const isFullscreen = document.fullscreenElement ||
                    document.webkitFullscreenElement ||
                    document.mozFullScreenElement ||
                    document.msFullscreenElement;
                if (isFullscreen) {
                    exitFullscreen();
                } else {
                    enterFullscreen();
                }
            });

            console.log("Mapa inicializado correctamente.");
        });
    </script>
</body>
</html>
